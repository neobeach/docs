<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Adding favicon -->
    

    <!-- Adding meta -->
    
    
    <meta name="author" content="Glenn de Haan" />
    
    <meta name="description" content="A collection of middlewares that can be used in combination with the @neobeach/core package" />
    
    

    <!-- Adding external script-->
    

    <!-- Adding external style-->
    

    <!-- Adding scripts-->
    

    <!-- Adding style-->
    

    <!-- Adding overlay script-->
    

    <!-- Adding overlay style-->
    


    <title>
      redirect/index.js
    </title>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/third-party/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/third-party/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/reset.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-base.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-dark.css">
    
    <svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    style="display:none">
    <defs>
        <symbol id="copy-icon" viewbox="0 0 488.3 488.3">
            <g>
                <path
                    d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z" />
                <path
                    d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z" />
            </g>
        </symbol>
        <symbol id='search-icon' viewBox="0 0 512 512">
            <g>
                <g>
                    <path
                        d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z" />
                </g>
            </g>
            <g>
                <g>
                    <path
                        d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z" />
                </g>
            </g>
        </symbol>
        <symbol id="down-icon" viewBox="0 0 16 16">
            <path 
                fill-rule="evenodd" 
                clip-rule="evenodd" 
                d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"
            >
            </path>
        </symbol>
    </defs>
</svg>
  </head>

  <body>

    <nav class="navbar" id="navbar">
      <div class="navbar-heading" id="navbar-heading"><a href="index.html"><h2 class="navbar-heading-text">Middlewares</h2></a></div><div class="search-box" id="search-box"><div class="search-box-input-container"><input class="search-box-input" type="text" placeholder="Search..." id="search-box-input" /><svg class="search-icon" alt="search-icon"><use xlink:href="#search-icon"></use></svg></div><div class="search-item-container" id="search-item-container"><ul class="search-item-ul" id="search-item-ul"></ul></div></div><div class="sidebar-main-content" id="sidebar-main-content"><ul><li class="menu-li"><a href='https://github.com/neobeach/core' class=' menu-link' id='' target='_blank'>@neobeach/core - GitHub</a></li><li class="menu-li"><a href='https://npmjs.com/@neobeach/core' class=' menu-link' id='' target='_blank'>@neobeach/core - NPM</a></li><li class="menu-li"><a href='https://neobeach.dev/core/' class=' menu-link' id='' target=''>Core - Documentation</a></li><li class="menu-li"><a href='https://neobeach.dev/middlewares/' class=' menu-link' id='' target=''>Middlewares - Documentation</a></li><li class="menu-li"><a href='https://neobeach.dev/modules/' class=' menu-link' id='' target=''>Modules - Documentation</a></li></ul><div class="accordion collapsed" id="4894335" > <h3 class="accordion-heading">Modules<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="module-@neobeach_middlewares-geoip.html">@neobeach/middlewares-geoip</a></li><li class="accordion-list" id=""><a href="module-@neobeach_middlewares-old-browser.html">@neobeach/middlewares-old-browser</a></li><li class="accordion-list" id=""><a href="module-@neobeach_middlewares-pwa.html">@neobeach/middlewares-pwa</a></li><li class="accordion-list" id=""><a href="module-@neobeach_middlewares-redirect.html">@neobeach/middlewares-redirect</a></li><li class="accordion-list" id=""><a href="module-@neobeach_middlewares-request-logger.html">@neobeach/middlewares-request-logger</a></li><li class="accordion-list" id=""><a href="module-@neobeach_middlewares-robots-txt.html">@neobeach/middlewares-robots-txt</a></li></ul> </div>
      

    </nav>
    <div class="navbar-ham" id="navbar-ham">
      <div>
        <div class="first"></div>
        <div class="second"></div>
        <div class="third"></div>
      </div>
    </div>

    <div id="main" class="main-content">
      
      <h1 id='page-title' class="page-title">
        redirect/index.js
      </h1>
      

      



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Import vendor modules
 */
const {Logger} = require('@neobeach/core');

/**
 * Simple redirect middleware
 *
 * @module @neobeach/middlewares-redirect
 * @access public
 * @since 1.0.0
 * @author Glenn de Haan
 * @copyright MIT
 *
 * @param {Object} redirects - An object containing all static and regex redirects
 * @param {Object} redirects.static - An object containing all static redirects
 * @param {Object} redirects.regex - An object containing all regex redirects
 * @param {Number} [status] - The HTTP status code used for the redirect
 * @return {function(*, *, *)}
 *
 * @example
 * const {Runtime, Server} = require('@neobeach/core');
 * const redirect = require('@neobeach/middlewares-redirect');
 *
 * const server = new Server();
 *
 * Runtime(() => {
 *    server.loadMiddlewares([redirect({static: {'/test': '/test1'}, regex: {'^/test123/.*': '/new'}})]);
 *    server.run();
 * });
 */
module.exports = (redirects = {}, status = 307) => {
    /**
     * Define statics
     */
    const valid_status_options = [301, 302, 307, 308];

    /**
     * Check if the provided redirects are correct
     */
    if (typeof redirects === 'undefined' || typeof redirects !== 'object') {
        Logger.error("[REDIRECT] Option 'redirects' must be an Object");
        process.exit(1);
        return;
    }
    if (typeof redirects.static === 'undefined' || typeof redirects.static !== 'object') {
        Logger.error("[REDIRECT] Option 'redirects.static' must be an Object");
        process.exit(1);
        return;
    }
    if (typeof redirects.regex === 'undefined' || typeof redirects.regex !== 'object') {
        Logger.error("[REDIRECT] Option 'redirects.regex' must be an Object");
        process.exit(1);
        return;
    }

    /**
     * Check if the provided status is correct
     */
    if (valid_status_options.indexOf(status) === -1) {
        Logger.warn(`[REDIRECT] Invalid option 'status' supplied. Options: ${valid_status_options}`);
        process.exit(1);
        return;
    }

    /**
     * Return the express middleware
     */
    return (req, res, next) => {
        const reqUrl = req.originalUrl.replace(/\/$/, '');
        const nonStrippedReqUrl = req.originalUrl;

        // Check for static redirects
        if (redirects.static[reqUrl]) {
            Logger.info(`[EXPRESS][REDIRECT] Static redirect found: ${reqUrl} -> ${redirects.static[reqUrl]}`);
            res.redirect(status, redirects.static[reqUrl]);
            return;
        }

        // Check for regex redirects
        const regexKeys = Object.keys(redirects.regex);
        for (let item = 0; item &lt; regexKeys.length; item++) {
            const reqRegex = regexKeys[item];
            const matcher = new RegExp(reqRegex);

            // Check if the provided regex matches the current url
            if (matcher.test(reqUrl) || matcher.test(nonStrippedReqUrl)) {
                const resUrl = redirects.regex[reqRegex];
                Logger.info(`[EXPRESS][REDIRECT] Regex redirect found: ${reqRegex} -> ${resUrl}`);

                // Check if the redirect url needs parts from the current url
                if (/\$[0-9]/.test(resUrl)) {
                    Logger.debug(`[EXPRESS][REDIRECT] Redirect url need parts from Current url`);

                    const match = reqUrl.match(matcher);
                    const nonStrippedMatch = nonStrippedReqUrl.match(matcher);

                    if (nonStrippedMatch !== null &amp;&amp; nonStrippedMatch[1] !== 'undefined') {
                        Logger.debug(`[EXPRESS][REDIRECT] Redirect url parts found!`);
                        return res.redirect(status, resUrl.replace(/\$[0-9]/, `${nonStrippedMatch[1]}`));
                    }

                    // Check if we have a match available for replacement
                    if (match !== null &amp;&amp; typeof match[1] !== 'undefined') {
                        Logger.debug(`[EXPRESS][REDIRECT] Redirect url parts found!`);
                        return res.redirect(status, resUrl.replace(/\$[0-9]/, `${match[1]}`));
                    } else {
                        Logger.debug(`[EXPRESS][REDIRECT] Redirect url parts not found!`);
                        return res.redirect(status, resUrl.replace('$1', ''));
                    }
                } else {
                    Logger.debug(`[EXPRESS][REDIRECT] Redirect url doesn't need parts from Current url`);
                    return res.redirect(status, resUrl);
                }
            }
        }

        next();
    };
};
</code></pre>
        </article>
    </section>




    </div>

    <footer class="footer" id="footer">
      
    </footer>

    <script src="scripts/third-party/prettify.js"></script>
    <script src="scripts/third-party/lang-css.js"></script>
    <script type="text/javascript" src="scripts/misc.js"></script>

    <script>prettyPrint();</script>
    <script src="scripts/linenumber.js"></script>
    <script src="scripts/fix-code-block.js"></script>
    <script src="scripts/fix-navbar.js"></script>
    
      <script src="scripts/search.js"></script>
      <script src="scripts/third-party/fuse.js"></script>
      <script>
        var list = [{"title":"@neobeach/middlewares-geoip","link":"<a href=\"module-@neobeach_middlewares-geoip.html\">@neobeach/middlewares-geoip</a>"},{"title":"@neobeach/middlewares-old-browser","link":"<a href=\"module-@neobeach_middlewares-old-browser.html\">@neobeach/middlewares-old-browser</a>"},{"title":"@neobeach/middlewares-pwa","link":"<a href=\"module-@neobeach_middlewares-pwa.html\">@neobeach/middlewares-pwa</a>"},{"title":"@neobeach/middlewares-redirect","link":"<a href=\"module-@neobeach_middlewares-redirect.html\">@neobeach/middlewares-redirect</a>"},{"title":"@neobeach/middlewares-request-logger","link":"<a href=\"module-@neobeach_middlewares-request-logger.html\">@neobeach/middlewares-request-logger</a>"},{"title":"@neobeach/middlewares-robots-txt","link":"<a href=\"module-@neobeach_middlewares-robots-txt.html\">@neobeach/middlewares-robots-txt</a>"}];
        var options = 
          setupSearch(list, options)
      </script>
    

    

    

    


  </body>

</html>
